<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minha Primeira Criptomoeda - Interface Web</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            text-align: center;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .section h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .info-box {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #2196f3;
        }

        .info-box strong {
            color: #1976d2;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            width: 100%;
            margin-top: 10px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            margin-top: 8px;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
        }

        label {
            display: block;
            margin-top: 15px;
            color: #333;
            font-weight: 500;
        }

        .status {
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .account-info {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #ffc107;
        }

        .balance {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            text-align: center;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸª™ Minha Primeira Criptomoeda</h1>
        <p class="subtitle">Interface Web para Interagir com Seu Token ERC-20</p>

        <div class="section">
            <h2>ðŸ“‹ InformaÃ§Ãµes do Contrato</h2>
            <div class="info-box">
                <strong>EndereÃ§o do Contrato (Ganache GUI):</strong><br>
                <code>0xe297f36c75e1B498346545239860adec4542A8Aa</code>
            </div>
            <div class="info-box">
                <strong>Nome:</strong> Minha Primeira Criptomoeda<br>
                <strong>SÃ­mbolo:</strong> MPC<br>
                <strong>Decimais:</strong> 18
            </div>
        </div>

        <div class="section">
            <h2>ðŸ”Œ ConexÃ£o</h2>
            <div id="connectionStatus" class="status info">
                Clique em "Conectar Metamask" para comeÃ§ar
            </div>
            <button id="connectBtn" onclick="connectWallet()">Conectar Metamask</button>
        </div>

        <div class="section" id="walletSection" style="display: none;">
            <h2>ðŸ‘› InformaÃ§Ãµes da Carteira</h2>
            <div class="account-info">
                <strong>Conta Conectada:</strong><br>
                <span id="accountAddress"></span>
            </div>
            <div class="balance">
                <div>Saldo de Tokens</div>
                <div id="tokenBalance">0 MPC</div>
            </div>
            <button onclick="updateBalance()">Atualizar Saldo</button>
        </div>

        <div class="section" id="transferSection" style="display: none;">
            <h2>ðŸ“¤ Transferir Tokens</h2>
            <label for="recipientAddress">EndereÃ§o de Destino:</label>
            <input type="text" id="recipientAddress" placeholder="0x..." />

            <label for="transferAmount">Quantidade (MPC):</label>
            <input type="number" id="transferAmount" placeholder="100" step="0.01" />

            <div id="transferStatus"></div>
            <button onclick="transferTokens()">Transferir Tokens</button>
        </div>

        <div class="section" id="approveSection" style="display: none;">
            <h2>âœ… Aprovar Gastos</h2>
            <label for="spenderAddress">EndereÃ§o Autorizado:</label>
            <input type="text" id="spenderAddress" placeholder="0x..." />

            <label for="approveAmount">Quantidade a Aprovar (MPC):</label>
            <input type="number" id="approveAmount" placeholder="50" step="0.01" />

            <div id="approveStatus"></div>
            <button onclick="approveTokens()">Aprovar Tokens</button>
        </div>
    </div>

    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
    <script>
        // EndereÃ§o do contrato deployado
        // Para Ganache GUI (porta 7545): 0xe297f36c75e1B498346545239860adec4542A8Aa
        // Para Ganache CLI (porta 8545): 0x051E1D5C68a2430e95CC8A68d4f3963e5F898bf5
        const CONTRACT_ADDRESS = '0xe297f36c75e1B498346545239860adec4542A8Aa';
        
        // ABI simplificado do contrato ERC-20
        const CONTRACT_ABI = [
            "function name() view returns (string)",
            "function symbol() view returns (string)",
            "function decimals() view returns (uint8)",
            "function totalSupply() view returns (uint256)",
            "function balanceOf(address) view returns (uint256)",
            "function transfer(address to, uint256 amount) returns (bool)",
            "function approve(address spender, uint256 amount) returns (bool)",
            "function allowance(address owner, address spender) view returns (uint256)",
            "function transferFrom(address from, address to, uint256 amount) returns (bool)",
            "event Transfer(address indexed from, address indexed to, uint256 value)",
            "event Approval(address indexed owner, address indexed spender, uint256 value)"
        ];

        let provider, signer, contract, userAddress;

        async function connectWallet() {
            try {
                if (typeof window.ethereum === 'undefined') {
                    alert('Metamask nÃ£o encontrado! Por favor, instale o Metamask.');
                    return;
                }

                // Solicitar conexÃ£o
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                
                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                userAddress = await signer.getAddress();
                contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);

                // Atualizar UI
                document.getElementById('accountAddress').textContent = userAddress;
                document.getElementById('connectionStatus').className = 'status success';
                document.getElementById('connectionStatus').textContent = 'Conectado com sucesso!';
                document.getElementById('connectBtn').disabled = true;
                document.getElementById('walletSection').style.display = 'block';
                document.getElementById('transferSection').style.display = 'block';
                document.getElementById('approveSection').style.display = 'block';

                // Atualizar saldo
                await updateBalance();

            } catch (error) {
                console.error('Erro ao conectar:', error);
                document.getElementById('connectionStatus').className = 'status error';
                document.getElementById('connectionStatus').textContent = 'Erro ao conectar: ' + error.message;
            }
        }

        async function updateBalance() {
            try {
                if (!contract) {
                    alert('Conecte sua carteira primeiro!');
                    return;
                }

                const balance = await contract.balanceOf(userAddress);
                const decimals = await contract.decimals();
                const symbol = await contract.symbol();
                
                const formattedBalance = ethers.utils.formatUnits(balance, decimals);
                document.getElementById('tokenBalance').textContent = formattedBalance + ' ' + symbol;

            } catch (error) {
                console.error('Erro ao atualizar saldo:', error);
                alert('Erro ao atualizar saldo: ' + error.message);
            }
        }

        async function transferTokens() {
            try {
                const recipient = document.getElementById('recipientAddress').value.trim();
                const amount = document.getElementById('transferAmount').value;

                if (!recipient || !amount) {
                    alert('Preencha todos os campos!');
                    return;
                }

                if (!ethers.utils.isAddress(recipient)) {
                    alert('EndereÃ§o invÃ¡lido!');
                    return;
                }

                const decimals = await contract.decimals();
                const amountWei = ethers.utils.parseUnits(amount, decimals);

                document.getElementById('transferStatus').className = 'status info';
                document.getElementById('transferStatus').textContent = 'Enviando transaÃ§Ã£o...';

                const tx = await contract.transfer(recipient, amountWei);
                document.getElementById('transferStatus').className = 'status info';
                document.getElementById('transferStatus').textContent = 'Aguardando confirmaÃ§Ã£o... (Hash: ' + tx.hash + ')';

                await tx.wait();
                
                document.getElementById('transferStatus').className = 'status success';
                document.getElementById('transferStatus').textContent = 'TransferÃªncia realizada com sucesso!';
                
                // Limpar campos
                document.getElementById('recipientAddress').value = '';
                document.getElementById('transferAmount').value = '';
                
                // Atualizar saldo
                await updateBalance();

            } catch (error) {
                console.error('Erro na transferÃªncia:', error);
                document.getElementById('transferStatus').className = 'status error';
                document.getElementById('transferStatus').textContent = 'Erro: ' + (error.message || 'TransaÃ§Ã£o falhou');
            }
        }

        async function approveTokens() {
            try {
                const spender = document.getElementById('spenderAddress').value.trim();
                const amount = document.getElementById('approveAmount').value;

                if (!spender || !amount) {
                    alert('Preencha todos os campos!');
                    return;
                }

                if (!ethers.utils.isAddress(spender)) {
                    alert('EndereÃ§o invÃ¡lido!');
                    return;
                }

                const decimals = await contract.decimals();
                const amountWei = ethers.utils.parseUnits(amount, decimals);

                document.getElementById('approveStatus').className = 'status info';
                document.getElementById('approveStatus').textContent = 'Enviando transaÃ§Ã£o...';

                const tx = await contract.approve(spender, amountWei);
                document.getElementById('approveStatus').className = 'status info';
                document.getElementById('approveStatus').textContent = 'Aguardando confirmaÃ§Ã£o... (Hash: ' + tx.hash + ')';

                await tx.wait();
                
                document.getElementById('approveStatus').className = 'status success';
                document.getElementById('approveStatus').textContent = 'AprovaÃ§Ã£o realizada com sucesso!';
                
                // Limpar campos
                document.getElementById('spenderAddress').value = '';
                document.getElementById('approveAmount').value = '';

            } catch (error) {
                console.error('Erro na aprovaÃ§Ã£o:', error);
                document.getElementById('approveStatus').className = 'status error';
                document.getElementById('approveStatus').textContent = 'Erro: ' + (error.message || 'TransaÃ§Ã£o falhou');
            }
        }

        // Verificar se jÃ¡ estÃ¡ conectado ao recarregar a pÃ¡gina
        window.addEventListener('load', async () => {
            if (typeof window.ethereum !== 'undefined') {
                const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                if (accounts.length > 0) {
                    connectWallet();
                }
            }
        });
    </script>
</body>
</html>

